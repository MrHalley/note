# 遇到的问题

> 工号锁

数据库锁获取工号两种情况下锁没有删除，导致死锁（后面程序无法获取到锁，生成不了工号，大量线程阻塞） 

  1.获取到锁后操作数据库时字段过长导致数据库抛出异常，然后锁没有删除

  2.锁没删除服务器断电，锁没删除

解决方案：

​	由原来的数据库锁改为redis锁，设置过期时间。锁没删除时，指定时间后过期，不影响下一线程继续获取锁生成工号。

   注意：如果加锁和设置过期时间非原子操作，中间突然断电没执行下去也会导致死锁。改用lua脚本进行原子性操作



信号量锁可以用作限流